window.gLocalAssetContainer["CTiles"] = function(g) { (function(exports, require, module, __filename, __dirname) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tiles=exports.MINE_MAX=exports.DST_TILE_SIZE=exports.SRC_TILE_SIZE=exports.TileState=void 0;const sceneTitle_1=require("./sceneTitle"),utilAkashic_1=require("./utilAkashic");exports.TileState={Zero:0,One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Close:8,Flag:9,Mine:10,Miss:11,Smile:12,Dizzy:13,Poo:14},exports.SRC_TILE_SIZE=80,exports.DST_TILE_SIZE=40,exports.MINE_MAX=99;const TILE_COLS=30,TILE_ROWS=16,VIEW_TILES=480,ALL_TILES=576,NEIGHBOR8=[-33,-32,-31,1,33,32,31,-1];class Tiles{constructor(e){this.tiles=new Array(576),this.openMine=0,this.pointByClick=0,this.rand=e;for(let e=0;e<this.tiles.length;e++)this.tiles[e]={};this.init()}init(){this.openMine=0;for(let e=0;e<this.tiles.length;e++){this.tiles[e];this.tiles[e].isWall=!1,this.tiles[e].isMine=!1,this.tiles[e].isOpen=!1,this.tiles[e].mCount=0,this.isWallTiles(e)?this.tiles[e].isWall=!0:null!=this.tiles[e].entity&&(this.tiles[e].entity.srcX=exports.SRC_TILE_SIZE*exports.TileState.Close,this.tiles[e].entity.invalidate())}}getCloseMine(){return exports.MINE_MAX-this.openMine}isOpen(e){return this.tiles[e].isOpen}isCloseZero(e){return!this.tiles[e].isOpen&&0===this.tiles[e].mCount}setTiles(e,t){const i=Tiles.changeXY2Idx(e,t);let s=[...Array(480).keys()];s=(0,utilAkashic_1.shuffleArray)(s,this.rand.gen());let l=0;for(let e=0;;e++){const t=s[e],o=t%30,n=32*(Math.floor(t/30)+1)+(o+1);if(!this.isSetBomb(n,i)&&(this.tiles[n].isMine=!0,NEIGHBOR8.forEach(e=>{this.tiles[n+e].mCount++}),l++,l>=exports.MINE_MAX))break}}append(e,t){for(let i=0;i<this.tiles.length;i++)if(!this.tiles[i].isWall){const s=i%32,l=Math.floor(i/32);this.tiles[i].entity=new g.Sprite({scene:e,src:e.asset.getImageById(sceneTitle_1.AST_TILES),srcWidth:exports.SRC_TILE_SIZE,srcHeight:exports.SRC_TILE_SIZE,width:exports.DST_TILE_SIZE,height:exports.DST_TILE_SIZE,srcX:exports.SRC_TILE_SIZE*exports.TileState.Close,x:exports.DST_TILE_SIZE*s,y:exports.DST_TILE_SIZE*(l+1),parent:t})}}isWallTiles(e){return e%32==0||(e%32==31||(e<32||e>=544))}isSetBomb(e,t){let i=!1;return e===t||(NEIGHBOR8.forEach(s=>{e===t+s&&(i=!0)}),i)}static changeXY2Idx(e,t){return 32*(Math.floor((t-80)/exports.DST_TILE_SIZE)+1)+(Math.floor((e-40)/exports.DST_TILE_SIZE)+1)}consoleLog(){let e="",t=0;this.tiles.forEach((i,s)=>{this.tiles[s].isWall||(this.tiles[s].isMine?e+="M ":e+=this.tiles[s].mCount+" ",t++,t>=30&&(console.log(e),t=0,e=""))})}refresh(e,t,i){const s=Tiles.changeXY2Idx(e,t),l=this.tiles[s];let o=!0;if(this.pointByClick=0,0===i){if(l.isOpen){if(l.isOpen&&!l.isMine){let e=[],t=0;NEIGHBOR8.forEach(i=>{const l=this.tiles[s+i];l.idx=s+i,l.isWall||(l.isOpen||e.push(l),l.isOpen&&!l.isMine||t++)}),t===l.mCount?e.forEach(e=>{this.openFlagTile(e),this.pointByClick+=1e3,this.openMine++}):t-e.length===l.mCount&&e.forEach(e=>{this.openCountTile(e),e.mCount===exports.TileState.Zero&&this.open(e.idx)})}}else l.isMine?(this.openBombTile(l),o=!1,this.openMine++):l.mCount===exports.TileState.Zero?(this.openCountTile(l),this.open(s)):this.openCountTile(l);let e=0,t=0;for(let i=33;i<543;i+=32)for(let s=i;s<i+30;s++)this.tiles[s].isOpen?this.tiles[s].isMine&&e++:t++;if(e===exports.MINE_MAX)for(let e=33;e<543;e+=32)for(let t=e;t<e+30;t++)this.tiles[t].isOpen||this.openCountTile(this.tiles[t]);else if(t===exports.MINE_MAX-e)for(let e=33;e<543;e+=32)for(let t=e;t<e+30;t++)this.tiles[t].isOpen||(this.openFlagTile(this.tiles[t]),this.pointByClick+=1e3,this.openMine++)}else if(2===i){l.isOpen||l.isMine?(this.openFlagTile(l),this.pointByClick+=1e3,this.openMine++):(this.openCountTile(l),o=!1);let e=0,t=0;for(let i=33;i<543;i+=32)for(let s=i;s<i+30;s++)this.tiles[s].isOpen?this.tiles[s].isMine&&e++:t++;if(!1===o&&t===exports.MINE_MAX-e)for(let e=33;e<543;e+=32)for(let t=e;t<e+30;t++)this.tiles[t].isOpen||(this.openFlagTile(this.tiles[t]),this.openMine++);else if(e===exports.MINE_MAX)for(let e=33;e<543;e+=32)for(let t=e;t<e+30;t++)this.tiles[t].isOpen||this.openCountTile(this.tiles[t])}return 0===this.getCloseMine()&&this.pointByClick++,o}open(e){NEIGHBOR8.forEach(t=>{this.tiles[e+t].isOpen||this.tiles[e+t].isWall||(this.openCountTile(this.tiles[e+t]),this.tiles[e+t].mCount===exports.TileState.Zero&&this.open(e+t))})}getTile(e){return this.tiles[e]}openCountTile(e){e.isOpen=!0,null!=e.entity&&(e.entity.srcX=exports.SRC_TILE_SIZE*e.mCount,e.entity.invalidate())}openBombTile(e){e.isOpen=!0,null!=e.entity&&(e.entity.srcX=exports.SRC_TILE_SIZE*exports.TileState.Mine,e.entity.invalidate())}openFlagTile(e){e.isOpen=!0,e.isMine=!0,null!=e.entity&&(e.entity.srcX=exports.SRC_TILE_SIZE*exports.TileState.Flag,e.entity.invalidate())}getPoint(){return this.pointByClick}}exports.Tiles=Tiles;
})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);
}